<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: C++ | 林克融]]></title>
  <link href="http://sayaku.github.io/blog/categories/c-plus-plus/atom.xml" rel="self"/>
  <link href="http://sayaku.github.io/"/>
  <updated>2017-10-05T23:14:38+08:00</updated>
  <id>http://sayaku.github.io/</id>
  <author>
    <name><![CDATA[sayaku]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[使用AIR透過ANE連接原生C++操控滑鼠-Part 2]]></title>
    <link href="http://sayaku.github.io/blog/2012/10/17/anec2/"/>
    <updated>2012-10-17T18:24:24+08:00</updated>
    <id>http://sayaku.github.io/blog/2012/10/17/anec2</id>
    <content type="html"><![CDATA[<p>我們最後產出一個dll動態連結類別檔</p>

<p>接下來我們要來撰寫AS端的程式碼</p>

<p>讓我們可以用鍵盤來控制滑鼠移動了！</p>

<!--more-->


<h3>Part2:AS端程式撰寫並生成ANE檔</h3>

<p>首先你可以在桌面上新建一個資料夾並且命名為<code>com<code></p>

<p>在裡面再創建一個資料夾,名稱可以用你的名字</p>

<p>最後打開flashdevelop新增一個as檔或是你用記事本編寫存成as檔也都可以</p>

<p>as檔的名稱可以自己取，這邊我取名<code>NativeApp.as</code></p>

<p>而這個as檔的路徑就像</p>

<p><code>com\ {yourName} \ {自己取的as}</code></p>

<p>以我的範例來說:</p>

<p><code>com\sayaku\NativeApp.as</code></p>

<p>內容如下</p>

<p><figure class='code'><figcaption><span>NativeApp.as </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
</pre></td><td class='code'><pre><code class='as3'><span class='line'><span class="k">package</span> <span class="nn">com.sayaku</span><span class="o">{&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>  <span class="k">import</span> <span class="nn">flash.external.ExtensionContext</span><span class="o">;</span>
</span><span class='line'>  <span class="c1">//如果想要讓此類別可以發送及偵聽事件可以繼承EventDispatcher</span>
</span><span class='line'>  <span class="kd">public</span> <span class="kd">class</span> <span class="n">NativeApp</span>
</span><span class='line'>  <span class="o">{</span>
</span><span class='line'>    <span class="kd">private</span> <span class="kd">var</span> <span class="n">_ec</span><span class="p">:</span><span class="kt">ExtensionContext</span><span class="o">;&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">pre</span><span class="o">&gt;&lt;</span><span class="n">code</span><span class="o">&gt;</span><span class="kd">public</span> <span class="kd">function </span><span class="nf">NativeApp</span><span class="o">()</span>
</span><span class='line'><span class="o">{</span>
</span><span class='line'>  <span class="n">_ec</span> <span class="o">=</span> <span class="n">ExtensionContext</span><span class="o">.</span><span class="na">createExtensionContext</span><span class="o">(</span><span class="s2">&quot;com.sayaku.NativeApp&quot;</span><span class="o">,</span> <span class="s2">&quot;&quot;</span><span class="o">);</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="kd">public</span> <span class="kd">function </span><span class="nf">setMousePos</span><span class="o">(</span><span class="n">_x</span><span class="o">:</span><span class="kt">int</span><span class="o">,</span> <span class="n">_y</span><span class="o">:</span><span class="kt">int</span><span class="o">):</span><span class="kt">void</span>
</span><span class='line'><span class="o">{</span>
</span><span class='line'>    <span class="c1">//調用原生C++的setMousePosition方法</span>
</span><span class='line'>   <span class="n">_ec</span><span class="o">.</span><span class="na">call</span><span class="o">(</span><span class="s1">&#39;setMousePosition&#39;</span><span class="o">,</span> <span class="n">_x</span><span class="o">,</span> <span class="n">_y</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'><span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="kd">public</span> <span class="kd">function </span><span class="nf">mouseClick</span><span class="o">():</span><span class="kt">void</span>
</span><span class='line'><span class="o">{</span>
</span><span class='line'>    <span class="c1">//調用原生C++的mouseClick方法＿</span>
</span><span class='line'>   <span class="n">_ec</span><span class="o">.</span><span class="na">call</span><span class="o">(</span><span class="s1">&#39;mouseClick&#39;</span><span class="o">,</span><span class="mi">0</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'><span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="kd">public</span> <span class="kd">function </span><span class="nf">dispose</span><span class="o">():</span><span class="kt">void</span>
</span><span class='line'><span class="o">{</span>
</span><span class='line'>  <span class="n">_ec</span><span class="o">.</span><span class="na">dispose</span><span class="o">();</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'><span class="o">&lt;/</span><span class="n">code</span><span class="o">&gt;&lt;/</span><span class="n">pre</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>  <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>下面這段createExtensionContext方法會返回一個ExtensionContext的實體
<code>ExtensionContext.createExtensionContext(&lsquo;com.sayaku.NativeApp&rsquo;, &lsquo;&rsquo;);</code>
createExtensionContext的第一個參數是"識別用的ID"在這裡應該要是<code>com.你的名字.你的AS名稱</code></p>

<p>第二個參數目前還不知道要怎麼用~可以先填字串</p>

<p>接著我們要將我們的as檔封裝成swc</p>

<p>封裝成swc我們要使用命令提是字元程式</p>

<p>首先打開附屬應用程式下的命令提示字元</p>

<p>輸入
<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cd &ldquo;你自己flexSDK\bin的完整路徑&rdquo;</span></code></pre></td></tr></table></div></figure></p>

<p>以我的為範例</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cd C:\Program Files\FlashDevelop\Tools\flexSDK4.6\bin</span></code></pre></td></tr></table></div></figure></p>

<p>會導航到我們自己flexSDK裡bin的目錄中</p>

<p>接下來我們下輸出swc的指令:
<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>acompc -source-path &ldquo;你com資料夾所在目錄的完整路徑&rdquo;-include-classes &ldquo;NativeApp.as的路徑&rdquo;-swf-version=&ldquo;你flashplayer的版本號&rdquo;-output &ldquo;輸出swc的路徑&rdquo;</span></code></pre></td></tr></table></div></figure></p>

<p>以我的範例:</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>acompc -source-path C:\Users\sayaKU\Desktop -include-classes com.sayaku.NativeApp -swf-version=14 -output C:\Users\sayaKU\Desktop\com.sayaku.NativeApp.swc</span></code></pre></td></tr></table></div></figure></p>

<p>按下enter就能在桌面上看到輸出的swc</p>

<p><img src="http://pcdn1.rimg.tw/photos/3034597_inootzk_l.jpg" alt="001" /></p>

<p>生成swc以後,我們就可以跟之前編譯出來的dll檔包裝成ane檔了</p>

<p>包裝ane檔需要下面幾項東西</p>

<p><strong>1.dll檔</strong></br>
<strong>2.swc檔</strong></br>
<strong>3.swc裡的swf檔</strong></br>
<strong>4.xml描述檔</strong></br></p>

<p>我們先來製作描述檔，名稱可以自己取,這邊我是取<code>aneexpo.xml</code></p>

<p>內容如下:</p>

<p><figure class='code'><figcaption><span>aneexpo.xml </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="nt">&lt;extension</span> <span class="na">xmlns=</span><span class="s">&quot;http://ns.adobe.com/air/extension/3.1&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>    <span class="nt">&lt;id&gt;</span>com.sayaku.NativeApp<span class="nt">&lt;/id&gt;</span>
</span><span class='line'>    <span class="nt">&lt;versionNumber&gt;</span>1<span class="nt">&lt;/versionNumber&gt;</span>
</span><span class='line'>    <span class="nt">&lt;platforms&gt;</span>
</span><span class='line'>        <span class="nt">&lt;platform</span> <span class="na">name=</span><span class="s">&quot;Windows-x86&quot;</span><span class="nt">&gt;&lt;br/&gt;</span>
</span><span class='line'>            <span class="nt">&lt;applicationDeployment&gt;&lt;br/&gt;</span>
</span><span class='line'>                <span class="nt">&lt;nativeLibrary&gt;</span>NativeApp.dll<span class="nt">&lt;/nativeLibrary&gt;&lt;br/&gt;</span>
</span><span class='line'>                <span class="nt">&lt;initializer&gt;</span>ExtInitializer<span class="nt">&lt;/initializer&gt;&lt;br/&gt;</span>
</span><span class='line'>                <span class="nt">&lt;finalizer&gt;</span>ExtFinalizer<span class="nt">&lt;/finalizer&gt;&lt;br/&gt;</span>
</span><span class='line'>            <span class="nt">&lt;/applicationDeployment&gt;&lt;br/&gt;</span>
</span><span class='line'>        <span class="nt">&lt;/platform&gt;&lt;br/&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/platforms&gt;</span>
</span><span class='line'><span class="nt">&lt;/extension&gt;</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>接下來我們建立一個資料夾命名可以自己取~我這邊是取aneexpo,用來裝入我們要發布ane檔的檔案</p>

<p>目前我們只有<code>NativeApp.dll</code><code>com.sayaku.NativeApp.swc</code><code>aneexpo.xml</code></p>

<p>還缺少一個swc裡的swf</p>

<p>所以我們直接將swc的副檔名直接改成zip</p>

<p>然後選擇解壓縮檔案去裡面尋找library.swf</p>

<p>然後把他拉出來</p>

<p>接下就可以把解壓縮出來的檔案砍掉</p>

<p>將壓縮檔副檔名zip改回成swc</p>

<p><img src="http://pcdn1.rimg.tw/photos/3034635_vbr2on7_l.jpg" alt="14" /></p>

<p>接下來終於進入到最後階段&hellip;&hellip;..發布ane檔</p>

<p>將aneexpo資料夾複製到你flexsdk\bin的目錄下</p>

<p>然後打開命令提示字元</p>

<p>先指向到flexsdk\bin的目錄下</p>

<p>然後輸入以下指令</p>

<p><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>adt -package -target ane NativeApp.ane &ldquo;xml描述檔路徑&rdquo; -swc &ldquo;swc檔路徑&rdquo;-platform Windows-x86 -C &ldquo;原生dll檔與swf檔&rdquo;</span></code></pre></td></tr></table></div></figure></p>

<p>以我的範例
<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>adt -package -target ane NativeAdd.ane expo/expo.xml -swc expo/com.sayaku.NativeAdd.swc -platform Windows-x86 -C expo NativeAdd.dll library.swf</span></code></pre></td></tr></table></div></figure></p>

<p>按下enter就會在flexsdk\bin目錄下生成一個ane檔</p>

<p><img src="http://pcdn1.rimg.tw/photos/3034643_3tiexo6_l.jpg" alt="15" /></p>

<p>有了ane檔接下來要來做測試</p>

<p>打開FlashDevelop開啟一個新的AIR專案</p>

<p>ane的使用方式可以參考這篇→<a href="http://blog.roodo.com/sayaku/archives/19907808.html">點我</a></p>

<p>裡面有講到ane的設定</p>

<p>我們就利用鍵盤來控制鼠標位置與點擊事件來做測試</p>

<p>主檔案NativaMouse.as的內容</p>

<p><figure class='code'><figcaption><span>NativaMouse.as </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
</pre></td><td class='code'><pre><code class='as3'><span class='line'><span class="kd">package</span>
</span><span class='line'><span class="o">{&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>   <span class="k">import</span> <span class="nn">com.sayaku.NativeApp</span><span class="o">;</span>
</span><span class='line'>   <span class="k">import</span> <span class="nn">flash.display.Sprite</span><span class="o">;</span>
</span><span class='line'>   <span class="k">import</span> <span class="nn">flash.events.KeyboardEvent</span><span class="o">;</span>
</span><span class='line'>   <span class="k">import</span> <span class="nn">flash.events.MouseEvent</span><span class="o">;</span>
</span><span class='line'>   <span class="k">import</span> <span class="nn">flash.ui.Keyboard</span><span class="o">;&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>   <span class="kd">public</span> <span class="kd">class</span> <span class="n">NativeMouse</span> <span class="kd">extends</span> <span class="n">Sprite</span>
</span><span class='line'>   <span class="o">{</span>
</span><span class='line'>    <span class="kd">private</span> <span class="kd">var</span> <span class="n">ane</span><span class="p">:</span><span class="kt">NativeApp</span><span class="o">;</span>
</span><span class='line'>    <span class="kd">private</span> <span class="n">var</span> <span class="o">&lt;</span><span class="n">em</span><span class="o">&gt;</span><span class="n">x</span><span class="o">:</span><span class="n">int</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span>
</span><span class='line'>    <span class="kd">private</span> <span class="n">var</span> <span class="o">&lt;/</span><span class="n">em</span><span class="o">&gt;</span><span class="n">y</span><span class="o">:</span><span class="n">int</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kd">function </span><span class="nf">NativeMouse</span><span class="o">():</span><span class="kt">void</span>
</span><span class='line'>    <span class="o">{</span>
</span><span class='line'>        <span class="n">ane</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">NativeApp</span><span class="o">();&lt;</span><span class="n">br</span><span class="o">/&gt;</span>
</span><span class='line'>        <span class="c1">//偵聽鍵盤事件</span>
</span><span class='line'>        <span class="n">stage</span><span class="o">.</span><span class="na">addEventListener</span><span class="o">(</span><span class="n">KeyboardEvent</span><span class="o">.</span><span class="na">KEY_DOWN</span><span class="o">,</span> <span class="n">keydown</span><span class="o">);&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">pre</span><span class="o">&gt;&lt;</span><span class="n">code</span><span class="o">&gt;</span>    <span class="c1">//畫一個黑色矩形做為測試滑鼠點擊的區域</span>
</span><span class='line'>    <span class="kd">var</span> <span class="n">sp</span><span class="p">:</span><span class="kt">Sprite</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">Sprite</span><span class="o">();</span>
</span><span class='line'>    <span class="n">addChild</span><span class="o">(</span><span class="n">sp</span><span class="o">);</span>
</span><span class='line'>    <span class="n">sp</span><span class="o">.</span><span class="na">graphics</span><span class="o">.</span><span class="na">beginFill</span><span class="o">(</span><span class="mh">0x000000</span><span class="o">);</span>
</span><span class='line'>    <span class="n">sp</span><span class="o">.</span><span class="na">graphics</span><span class="o">.</span><span class="na">drawRect</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">100</span><span class="o">,</span> <span class="mi">100</span><span class="o">);</span>
</span><span class='line'>    <span class="n">sp</span><span class="o">.</span><span class="na">graphics</span><span class="o">.</span><span class="na">endFill</span><span class="o">();</span>
</span><span class='line'>    <span class="n">sp</span><span class="o">.</span><span class="na">buttonMode</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
</span><span class='line'>    <span class="n">sp</span><span class="o">.</span><span class="na">addEventListener</span><span class="o">(</span><span class="n">MouseEvent</span><span class="o">.</span><span class="na">CLICK</span><span class="o">,</span> <span class="kd">function</span><span class="o">(</span><span class="n">e</span><span class="o">:</span><span class="n">MouseEvent</span><span class="o">):</span><span class="kc">void</span> <span class="o">{</span> <span class="nf">trace</span><span class="o">(</span><span class="s2">&quot;我點到了!!&quot;</span><span class="o">)</span> <span class="o">}</span> <span class="o">);</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="kd">private</span> <span class="kd">function </span><span class="nf">keydown</span><span class="o">(</span><span class="n">e</span><span class="o">:</span><span class="kt">KeyboardEvent</span><span class="o">):</span><span class="kt">void</span>
</span><span class='line'><span class="o">{</span>
</span><span class='line'>    <span class="c1">//根據鍵盤按的方向去移動滑鼠的位置</span>
</span><span class='line'>    <span class="k">switch</span><span class="o">(</span><span class="n">e</span><span class="o">.</span><span class="na">keyCode</span><span class="o">)</span>
</span><span class='line'>            <span class="o">{</span>
</span><span class='line'>     <span class="k">case</span> <span class="n">Keyboard</span><span class="o">.</span><span class="na">UP</span><span class="o">:</span>      <span class="n">_y</span><span class="o">-=</span><span class="mi">5</span><span class="o">;</span>
</span><span class='line'>                    <span class="n">ane</span><span class="o">.</span><span class="na">setMousePos</span><span class="o">(</span><span class="n">_x</span><span class="o">,</span> <span class="n">_y</span><span class="o">);</span>
</span><span class='line'>                <span class="k">break</span><span class="o">;</span>
</span><span class='line'>     <span class="k">case</span> <span class="n">Keyboard</span><span class="o">.</span><span class="na">DOWN</span><span class="o">:</span>    <span class="n">_y</span><span class="o">+=</span><span class="mi">5</span><span class="o">;</span>
</span><span class='line'>                    <span class="n">ane</span><span class="o">.</span><span class="na">setMousePos</span><span class="o">(</span><span class="n">_x</span><span class="o">,</span> <span class="n">_y</span><span class="o">);</span>
</span><span class='line'>                <span class="k">break</span><span class="o">;</span>
</span><span class='line'>     <span class="k">case</span> <span class="n">Keyboard</span><span class="o">.</span><span class="na">LEFT</span><span class="o">:</span>    <span class="n">_x</span><span class="o">-=</span><span class="mi">5</span><span class="o">;</span>
</span><span class='line'>                    <span class="n">ane</span><span class="o">.</span><span class="na">setMousePos</span><span class="o">(</span><span class="n">_x</span><span class="o">,</span> <span class="n">_y</span><span class="o">);</span>
</span><span class='line'>                <span class="k">break</span><span class="o">;</span>
</span><span class='line'>     <span class="k">case</span> <span class="n">Keyboard</span><span class="o">.</span><span class="na">RIGHT</span><span class="o">:</span>   <span class="n">_x</span><span class="o">+=</span><span class="mi">5</span><span class="o">;</span>
</span><span class='line'>                    <span class="n">ane</span><span class="o">.</span><span class="na">setMousePos</span><span class="o">(</span><span class="n">_x</span><span class="o">,</span> <span class="n">_y</span><span class="o">);</span>
</span><span class='line'>                <span class="k">break</span><span class="o">;</span>
</span><span class='line'>     <span class="k">case</span> <span class="n">Keyboard</span><span class="o">.</span><span class="na">SPACE</span><span class="o">:</span>   <span class="n">ane</span><span class="o">.</span><span class="na">mouseClick</span><span class="o">()</span> <span class="o">;</span>
</span><span class='line'>                    <span class="k">break</span><span class="o">;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="o">}</span>
</span><span class='line'><span class="o">&lt;/</span><span class="n">code</span><span class="o">&gt;&lt;/</span><span class="n">pre</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;}</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>發布後我們就可以用鍵盤去控制鼠標的位置</p>

<p>並且移到黑色方塊上按下空白鍵也會發生點擊事件喔!</p>

<p><img src="http://pcdn1.rimg.tw/photos/3034695_kvn5a94_l.jpg" alt="16" /></p>

<p>原始檔底加→<a href="http://dl.dropbox.com/u/68443214/ANEMouse.rar">點我</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[使用AIR透過ANE連接原生C++操控滑鼠-Part 1]]></title>
    <link href="http://sayaku.github.io/blog/2012/10/17/anec1/"/>
    <updated>2012-10-17T15:30:50+08:00</updated>
    <id>http://sayaku.github.io/blog/2012/10/17/anec1</id>
    <content type="html"><![CDATA[<p><img src="http://pcdn1.rimg.tw/photos/3030609_smej5qs_l.jpg" alt="12" /></p>

<!--more-->


<p>大家好我是阿邪。</p>

<p>以前在製作FLASH時，我們可以透過滑鼠的控制來達成許多互動效果。</p>

<p>可是今天如果反過來說:那我們能不能不用滑鼠去控制系統滑鼠座標與點擊動作?</p>

<p>FLASH能辦到的只有透過dispatchEvent()去發送一個假的滑鼠點擊事件，但充其量它還是個模擬出來的假事件!!</p>

<p>改變系統滑鼠座標，單靠目前的FLASH是辦不到的，還是得靠系統原生語言來控制!</p>

<p>好在現在我們可以利用AIR透過ANE(AIR Native Extension)原生擴充功能來與原生語言動態函式庫的聯繫。</p>

<p>目前關於ANE的文章大部分都是以行動裝置ios,android的原生拓展的文章較多</p>

<p>桌面應用程式方面的原生拓展文章則較少著墨。</p>

<p>剛好現在做的專案遇到這樣的問題，順便來筆記一下如何讓AIR透過ANE去跟C++溝通。</p>

<p>本教學原文是參考此篇教學:<a href="http://rhuno.com/flashblog/2012/04/30/tutorial-flash-and-c-native-extension/">點我</a></p>

<h4>以下是我的開發環境:</h4>

<p><a href="http://www.flashdevelop.org/">FlashDevelop 4.0.4 RTM</a></br>
<a href="http://www.adobe.com/devnet/flex/flex-sdk-download.html">FlexSDK 4.6(目前最新版本為4.6)</a></br>
<a href="http://www.adobe.com/devnet/air/air-sdk-download.html">AIRSDK 3.3 (目前最新版本為3.4，至少要3.0以上)</a></br>
<a href="http://www.microsoft.com/visualstudio/eng/products/visual-studio-express-products">M$ Visual Studio Express 2012</a></br></p>

<h3>Part1 : C++端的程式撰寫</h3>

<p>在此聲明!我是個Flasher!!我完完全全的不會寫C++</p>

<p>所以內文有疑慮或是解釋錯的地方煩請高手多多包涵!</p>

<p>首先打開我們的Visual Studio Express 2012</p>

<p>新增專案:</p>

<p><img src="http://pcdn1.rimg.tw/photos/3030295_ca9jfsq_l.jpg" alt="01" /></p>

<p>選擇Win32專案</p>

<p>並填好專案名稱跟儲存位置</p>

<p>我專案名稱是命名NativeApp</p>

<p><img src="http://pcdn1.rimg.tw/photos/3030297_5kwzpib_l.jpg" alt="02" /></p>

<p>應用程式類型選擇為DLL(Dynamic Link Library)動態連結類別庫</p>

<p><img src="http://pcdn1.rimg.tw/photos/3030439_dvfphnv_l.jpg" alt="03" /></p>

<p>先到dllmain.cpp,這是dll程式的進入點</p>

<p>將dllmain.cpp預設內容改成</p>

<p><figure class='code'><figcaption><span>dllmain.cpp </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='cpp'><span class='line'><span class="c1">// dllmain.cpp : 定義 DLL 應用程式的進入點。&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">h1</span><span class="o">&gt;</span><span class="n">include</span> <span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">windows</span><span class="p">.</span><span class="n">h</span><span class="o">&gt;&lt;/</span><span class="n">h1</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="n">BOOL</span> <span class="n">APIENTRY</span> <span class="n">DllMain</span><span class="p">(</span> <span class="n">HMODULE</span> <span class="n">hModule</span><span class="p">,</span>
</span><span class='line'>                       <span class="n">DWORD</span>  <span class="n">ul_reason_for_call</span><span class="p">,</span>
</span><span class='line'>                       <span class="n">LPVOID</span> <span class="n">lpReserved</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>      <span class="k">return</span> <span class="n">TRUE</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>之後將原始程式檔裡的<code>stdafx.cpp</code>跟標頭檔裡兩個<code>stdafx.h</code>跟<code>targetver.h</code>砍掉</p>

<p>然後到你下載好的flex sdk裡include資料夾</p>

<p>將裡面的<code>FlashRuntimeExtensions.h</code>複製起來</p>

<p>到你NativeApp的專案裡的NativeApp資料夾貼上</p>

<p><img src="http://pcdn1.rimg.tw/photos/3030359_j9885ui_l.jpg" alt="04" /></p>

<p>OK之後再回到Flex SDK>lib找到win資料夾</p>

<p>裡面有一個<code>FlashRuntimeExtensions.lib</code>把它複製起來</p>

<p>一樣把它丟到你NativeApp的專案裡的NativeApp資料夾</p>

<p><img src="http://pcdn1.rimg.tw/photos/3030377_mtcyb9y_l.jpg" alt="05" /></p>

<p>這個階段OK之後回到Visual Studio Express 2012</p>

<p>在標頭檔的資料夾上按右鍵加入>現有項目>FlashRuntimeExtensions.h</p>

<p>結束後再加入一個新增項目>選擇標頭檔(.h),然後命名<code>NativeApp.h</code></p>

<p><img src="http://pcdn1.rimg.tw/photos/3030381_z6ypkai_l.jpg" alt="06" /></p>

<p>下一個步驟就是將<code>FlashRuntimeExtensions.lib</code>給加進來</p>

<p>在上面的NativeApp按右建>加入>現有項目>FlashRuntimeExtensions.lib</p>

<p>全部改完之後會像這樣</p>

<p><img src="http://pcdn1.rimg.tw/photos/3030389_4pn6q5h_l.jpg" alt="07" /></p>

<p>接下來因為我們之前去掉<code>stdafx.h</code>，我們需要告訴編譯器不要找到他!不然會一直出錯!!</p>

<p>我們到NativeApp上按右鍵選擇屬性 > C/C++ > 先行編譯標頭檔選擇未使用先行編譯標頭檔!</p>

<p><img src="http://pcdn1.rimg.tw/photos/3030393_uddbl1m_l.jpg" alt="08" /></p>

<p>設定差不多了!可以開始coding了!</p>

<p>首先打開<code>NativeApp.h</code></p>

<p>我們輸入以下程式碼</p>

<p><figure class='code'><figcaption><span>NativeApp.h </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='cpp'><span class='line'><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">h1</span><span class="o">&gt;</span><span class="n">include</span> <span class="o">&amp;</span><span class="n">ldquo</span><span class="p">;</span><span class="n">FlashRuntimeExtensions</span><span class="p">.</span><span class="n">h</span><span class="o">&amp;</span><span class="n">rdquo</span><span class="p">;</span><span class="o">&lt;/</span><span class="n">h1</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="c1">//用 extern &amp;ldquo;C&quot;將C++指令轉換成C語言</span>
</span><span class='line'><span class="c1">//原因是防止C++名稱重整器造成函數名稱的錯位</span>
</span><span class='line'><span class="k">extern</span> <span class="s">&quot;C&amp;rdquo;</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="kr">__declspec</span><span class="p">(</span><span class="n">dllexport</span><span class="p">)</span> <span class="kt">void</span> <span class="n">ExtInitializer</span><span class="p">(</span><span class="kt">void</span><span class="o">&lt;</span><span class="n">em</span><span class="o">&gt;&lt;</span><span class="n">em</span><span class="o">&gt;</span> <span class="n">extDataToSet</span><span class="p">,</span> <span class="n">FREContextInitializer</span><span class="o">&lt;/</span><span class="n">em</span><span class="o">&gt;</span> <span class="n">ctxInitializerToSet</span><span class="p">,</span> <span class="n">FREContextFinalizer</span><span class="o">&lt;/</span><span class="n">em</span><span class="o">&gt;</span> <span class="n">ctxFinalizerToSet</span><span class="p">);</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>  <span class="kr">__declspec</span><span class="p">(</span><span class="n">dllexport</span><span class="p">)</span> <span class="kt">void</span> <span class="n">ExtFinalizer</span><span class="p">(</span><span class="kt">void</span><span class="o">*</span> <span class="n">extData</span><span class="p">);</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>  <span class="kr">__declspec</span><span class="p">(</span><span class="n">dllexport</span><span class="p">)</span> <span class="n">FREObject</span> <span class="n">setMousePosition</span><span class="p">(</span><span class="n">FREContext</span> <span class="n">ctx</span><span class="p">,</span> <span class="kt">void</span><span class="o">*</span> <span class="n">funcData</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="n">argc</span><span class="p">,</span> <span class="n">FREObject</span> <span class="n">argv</span><span class="p">[]);</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>  <span class="kr">__declspec</span><span class="p">(</span><span class="n">dllexport</span><span class="p">)</span> <span class="n">FREObject</span> <span class="n">mouseClick</span><span class="p">(</span><span class="n">FREContext</span> <span class="n">ctx</span><span class="p">,</span> <span class="kt">void</span><span class="o">*</span> <span class="n">funcData</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="n">argc</span><span class="p">,</span> <span class="n">FREObject</span> <span class="n">argv</span><span class="p">[]);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>這邊宣告四種方法</p>

<p><strong>初始化(ExtInitializer)與終結(ExtFinalizer)這兩個方法是必須的</strong></p>

<p><strong>setMousePosition,mouseClick這兩個方法是用來給AS3調用的</strong></p>

<p><strong>setMousePosition是改變系統滑鼠的座標</strong></p>

<p><strong>mouseClick是觸發系統的滑鼠Click</strong></p>

<p>接下來編寫<code>NativeApp.cpp</code>
輸入以下程式</p>

<p><figure class='code'><figcaption><span>NativeApp.cpp </span></figcaption>
<div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
</pre></td><td class='code'><pre><code class='cpp'><span class='line'><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">h1</span><span class="o">&gt;</span><span class="n">include</span> <span class="o">&amp;</span><span class="n">ldquo</span><span class="p">;</span><span class="n">NativeApp</span><span class="p">.</span><span class="n">h</span><span class="o">&amp;</span><span class="n">rdquo</span><span class="p">;</span><span class="o">&lt;/</span><span class="n">h1</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">h1</span><span class="o">&gt;</span><span class="n">include</span> <span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">stdlib</span><span class="p">.</span><span class="n">h</span><span class="o">&gt;&lt;/</span><span class="n">h1</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">h1</span><span class="o">&gt;</span><span class="n">include</span> <span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">windows</span><span class="p">.</span><span class="n">h</span><span class="o">&gt;&lt;/</span><span class="n">h1</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="k">extern</span> <span class="o">&amp;</span><span class="n">ldquo</span><span class="p">;</span><span class="n">C</span><span class="o">&amp;</span><span class="n">rdquo</span><span class="p">;</span>
</span><span class='line'><span class="p">{</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>   <span class="n">FREObject</span> <span class="n">setMousePosition</span><span class="p">(</span><span class="n">FREContext</span> <span class="n">ctx</span><span class="p">,</span> <span class="kt">void</span><span class="o">*</span> <span class="n">funcData</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="n">argc</span><span class="p">,</span> <span class="n">FREObject</span> <span class="n">argv</span><span class="p">[])</span>
</span><span class='line'>   <span class="p">{</span>
</span><span class='line'>    <span class="c1">//AS3傳來的參數會存在argv[]裡</span>
</span><span class='line'>    <span class="kt">int32_t</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">;</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">pre</span><span class="o">&gt;&lt;</span><span class="n">code</span><span class="o">&gt;</span><span class="c1">//將AS3數據轉成C++</span>
</span><span class='line'><span class="n">FREGetObjectAsInt32</span> <span class="p">(</span> <span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span><span class="n">x</span><span class="p">);</span>
</span><span class='line'><span class="n">FREGetObjectAsInt32</span> <span class="p">(</span> <span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span><span class="n">y</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//設定系統的座標,為Windows.h裡的方法</span>
</span><span class='line'><span class="n">SetCursorPos</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">//如果不在意回傳數值就回傳第一個參數</span>
</span><span class='line'><span class="c1">//如果需要回傳經計算過的數值請記得利用FRE Object轉成AS3看得懂的數據</span>
</span><span class='line'><span class="k">return</span> <span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
</span><span class='line'><span class="o">&lt;/</span><span class="n">code</span><span class="o">&gt;&lt;/</span><span class="n">pre</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>   <span class="p">}</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>   <span class="n">FREObject</span> <span class="n">mouseClick</span><span class="p">(</span><span class="n">FREContext</span> <span class="n">ctx</span><span class="p">,</span> <span class="kt">void</span><span class="o">*</span> <span class="n">funcData</span><span class="p">,</span> <span class="kt">uint32_t</span> <span class="n">argc</span><span class="p">,</span> <span class="n">FREObject</span> <span class="n">argv</span><span class="p">[])</span>
</span><span class='line'>   <span class="p">{</span>
</span><span class='line'>    <span class="c1">//觸發滑鼠事件,click事件其實就是mousedown跟mouseup的組合</span>
</span><span class='line'>    <span class="n">mouse_event</span><span class="p">(</span><span class="n">MOUSEEVENTF_LEFTDOWN</span> <span class="o">|</span> <span class="n">MOUSEEVENTF_LEFTUP</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span> <span class="p">);</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
</span><span class='line'>   <span class="p">}</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span>   <span class="kt">void</span> <span class="n">ContextInitializer</span><span class="p">(</span><span class="kt">void</span><span class="o">&lt;</span><span class="n">em</span><span class="o">&gt;</span> <span class="n">extData</span><span class="p">,</span> <span class="k">const</span> <span class="kt">uint8_t</span><span class="o">&lt;/</span><span class="n">em</span><span class="o">&gt;</span> <span class="n">ctxType</span><span class="p">,</span> <span class="n">FREContext</span> <span class="n">ctx</span><span class="p">,</span> <span class="kt">uint32_t</span><span class="o">&lt;</span><span class="n">em</span><span class="o">&gt;</span> <span class="n">numFunctions</span><span class="p">,</span> <span class="k">const</span> <span class="n">FRENamedFunction</span><span class="o">**</span> <span class="n">functions</span><span class="p">)</span>
</span><span class='line'>   <span class="p">{</span>
</span><span class='line'>    <span class="c1">//在初始化時宣告可以被AS3調用的方法</span>
</span><span class='line'>    <span class="o">&lt;/</span><span class="n">em</span><span class="o">&gt;</span><span class="n">numFunctions</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
</span><span class='line'>    <span class="n">FRENamedFunction</span><span class="o">&lt;</span><span class="n">em</span><span class="o">&gt;</span> <span class="n">func</span> <span class="o">=</span> <span class="p">(</span><span class="n">FRENamedFunction</span><span class="o">&lt;/</span><span class="n">em</span><span class="o">&gt;</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="n">FRENamedFunction</span><span class="p">)</span><span class="o">&lt;</span><span class="n">em</span><span class="o">&gt;</span><span class="p">(</span><span class="o">&lt;/</span><span class="n">em</span><span class="o">&gt;</span><span class="n">numFunctions</span><span class="p">));</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">pre</span><span class="o">&gt;&lt;</span><span class="n">code</span><span class="o">&gt;</span><span class="n">func</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">name</span> <span class="o">=</span> <span class="p">(</span><span class="k">const</span> <span class="kt">uint8_t</span><span class="o">*</span><span class="p">)</span><span class="s">&quot;setMousePosition&quot;</span><span class="p">;</span>
</span><span class='line'><span class="n">func</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">functionData</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
</span><span class='line'><span class="n">func</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">function</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span><span class="n">setMousePosition</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="n">func</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">name</span> <span class="o">=</span> <span class="p">(</span><span class="k">const</span> <span class="kt">uint8_t</span><span class="o">*</span><span class="p">)</span><span class="s">&quot;mouseClick&quot;</span><span class="p">;</span>
</span><span class='line'><span class="n">func</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">functionData</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
</span><span class='line'><span class="n">func</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">function</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span><span class="n">mouseClick</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="o">*</span><span class="n">functions</span> <span class="o">=</span> <span class="n">func</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">ContextFinalizer</span><span class="p">(</span><span class="n">FREContext</span> <span class="n">ctx</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'><span class="k">return</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">ExtInitializer</span><span class="p">(</span><span class="kt">void</span><span class="o">**</span> <span class="n">extData</span><span class="p">,</span> <span class="n">FREContextInitializer</span><span class="o">*</span> <span class="n">ctxInitializer</span><span class="p">,</span> <span class="n">FREContextFinalizer</span><span class="o">*</span> <span class="n">ctxFinalizer</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>
</span><span class='line'><span class="o">*</span><span class="n">ctxInitializer</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span><span class="n">ContextInitializer</span><span class="p">;</span>
</span><span class='line'><span class="o">*</span><span class="n">ctxFinalizer</span>   <span class="o">=</span> <span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span><span class="n">ContextFinalizer</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">ExtFinalizer</span><span class="p">(</span><span class="kt">void</span><span class="o">*</span> <span class="n">extData</span><span class="p">)</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'><span class="k">return</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="o">&lt;/</span><span class="n">code</span><span class="o">&gt;&lt;/</span><span class="n">pre</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure></p>

<p>結束後!程式就完成了!可以編譯出dll檔</p>

<p>選擇上方的"建置">建置方案</p>

<p>當然你可以選擇你要編譯debug還是release版本</p>

<p><img src="http://pcdn1.rimg.tw/photos/3030423_c0xo82a_l.jpg" alt="9" /></p>

<p>編譯成功下面會輸出</p>

<p><img src="http://pcdn1.rimg.tw/photos/3030425_bondyg4_l.jpg" alt="10" /></p>

<p>關於C++與AS3之間的數據轉換的類別可以參考→<a href="http://help.adobe.com/en_US/air/extensions/WS460ee381960520ad-866f9c112aa6e1ad46-7ff8.html">點我</a></p>
]]></content>
  </entry>
  
</feed>
